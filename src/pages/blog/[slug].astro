---
import BlogLayout from "../../layouts/BlogLayout.astro";
import { getAllSlugs, getPostBySlug } from "../../lib/posts";

// Pre-render all blog post slugs
export async function getStaticPaths(): Promise<Array<{ params: { slug: string } }>> {
  const slugs = getAllSlugs();
  return slugs.map(s => ({ params: { slug: s } }));
}

const slug = String(Astro.params.slug ?? '');
const post = getPostBySlug(slug);
const PostContent = post?.default;
---

{post ? (
  <BlogLayout frontmatter={post.frontmatter}>
    <div>
      <PostContent />
    </div>
  </BlogLayout>
) : (
  <html>
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Post not found</title>
    </head>
    <body>
      <main style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0b1220;color:#e6edf3;font-family:Inter,system-ui,sans-serif;">
        <div style="max-width:640px;padding:24px;text-align:center;">
          <h1>404 â€” Post not found</h1>
          <p>The post you requested (<code>{slug}</code>) does not exist.</p>
          <p><a href="/blog" style="color:#8b5cf6;text-decoration:underline;">Back to blog</a></p>
        </div>
      </main>
    </body>
  </html>
)}
